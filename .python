import json
import os
import hashlib

USERS_FILE = "users.json"

def hash_password(password):
    return hashlib.sha256(password.encode()).hexdigest()

# Load users
if os.path.exists(USERS_FILE):
    with open(USERS_FILE, "r") as f:
        users = json.load(f)
else:
    users = {}

print("=== Welcome to Kydra ===")
choice = input("Login or Register? (l/r): ").lower()

username = input("Username: ")
password = input("Password: ")
password_hash = hash_password(password)

if choice == "r":
    if username in users:
        print("User already exists.")
        exit()
    users[username] = password_hash
    with open(USERS_FILE, "w") as f:
        json.dump(users, f)
    print("Registered!")

elif choice == "l":
    if username not in users or users[username] != password_hash:
        print("Wrong username or password.")
        exit()
    print("Logged in!")

# User data file
data_file = f"{username}_data.json"

if os.path.exists(data_file):
    with open(data_file, "r") as f:
        data = json.load(f)
else:
    data = {}

key = input("Enter keyword: ")

if key in data:
    print("Current text:")
    print(data[key])
else:
    print("No text yet for this keyword.")

new_text = input("Enter new text: ")
data[key] = new_text

with open(data_file, "w") as f:
    json.dump(data, f)

print("Saved!")
